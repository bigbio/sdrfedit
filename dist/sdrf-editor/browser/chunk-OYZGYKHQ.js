import{a as s,b as p,f as c,g as u,h as g}from"./chunk-KAWQVD33.js";var f={openai:{model:"gpt-4o-mini",baseUrl:"https://api.openai.com/v1",timeoutMs:6e4,maxTokens:4096,temperature:.3},anthropic:{model:"claude-sonnet-4-20250514",baseUrl:"https://api.anthropic.com/v1",timeoutMs:6e4,maxTokens:4096,temperature:.3},gemini:{model:"gemini-2.0-flash",baseUrl:"https://generativelanguage.googleapis.com/v1beta",timeoutMs:6e4,maxTokens:4096,temperature:.3},ollama:{model:"qwen3",baseUrl:"http://localhost:11434",timeoutMs:12e4,maxTokens:4096,temperature:.3}},b={openai:["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-3.5-turbo"],anthropic:["claude-sonnet-4-20250514","claude-3-5-haiku-20241022","claude-3-opus-20240229"],gemini:["gemini-2.0-flash","gemini-1.5-pro","gemini-1.5-flash"],ollama:["qwen3","llama3.2","llama3.1","mistral","mixtral","codellama","phi3"]},h={activeProvider:"openai",providers:{},storageConsent:!1,storageMode:"session"},a=class extends Error{constructor(r,e,o,i){super(r);this.code=e;this.provider=o;this.details=i;this.name="LlmError"}};function v(n,t){return{recommendations:[],summary:{total:0,byType:{fill_value:0,correct_value:0,ontology_suggestion:0,consistency_fix:0,add_column:0},byConfidence:{high:0,medium:0,low:0},affectedColumns:[],affectedSamples:0},timestamp:new Date,provider:n,model:t}}function C(){return`rec_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function L(n){return{openai:"OpenAI",anthropic:"Claude",gemini:"Google Gemini",ollama:"Ollama (Local)"}[n]}function P(n){return n!=="ollama"}function T(n){return n?n.provider==="ollama"?!0:!!n.apiKey&&n.apiKey.length>0:!1}function x(n){let t={fill_value:0,correct_value:0,ontology_suggestion:0,consistency_fix:0,add_column:0},r={high:0,medium:0,low:0},e=new Set,o=new Set;for(let i of n){t[i.type]++,r[i.confidence]++,e.add(i.column);for(let l of i.sampleIndices)o.add(l)}return{total:n.length,byType:t,byConfidence:r,affectedColumns:Array.from(e),affectedSamples:o.size}}var y=class{config;abortController=null;constructor(t={}){let r=this.getProviderType(),e=f[r];this.config=s(s({provider:r},e),t)}isConfigured(){return this.config.provider==="ollama"?!0:!!this.config.apiKey&&this.config.apiKey.length>0}getConfig(){return s({},this.config)}setConfig(t){this.config=s(s({},this.config),t)}abort(){this.abortController&&(this.abortController.abort(),this.abortController=null)}fetchWithTimeout(t,r){return c(this,null,function*(){this.abortController=new AbortController;let e=setTimeout(()=>{this.abortController?.abort()},this.config.timeoutMs||6e4);try{return yield fetch(t,p(s({},r),{signal:this.abortController.signal}))}catch(o){throw o instanceof Error?o.name==="AbortError"?new a("Request was aborted or timed out","TIMEOUT",this.config.provider):new a(`Network error: ${o.message}`,"NETWORK_ERROR",this.config.provider,o):o}finally{clearTimeout(e)}})}fetchStream(t,r){return c(this,null,function*(){let e=yield this.fetchWithTimeout(t,r);if(!e.ok){let o=yield e.text().catch(()=>"Unknown error");throw this.createErrorFromResponse(e.status,o)}if(!e.body)throw new a("Response body is empty","PROVIDER_ERROR",this.config.provider);return e.body.getReader()})}parseSSEStream(t){return g(this,null,function*(){let r=new TextDecoder,e="";try{for(;;){let{done:o,value:i}=yield new u(t.read());if(o)break;e+=r.decode(i,{stream:!0});let l=e.split(`
`);e=l.pop()||"";for(let R of l){let m=R.trim();if(!(!m||m.startsWith(":"))&&m.startsWith("data: ")){let d=m.slice(6);if(d==="[DONE]")return;yield d}}}}finally{t.releaseLock()}})}createErrorFromResponse(t,r){let e="PROVIDER_ERROR",o=`API error (${t})`;try{let i=JSON.parse(r);o=i.error?.message||i.message||o}catch{r.length<200&&(o=r||o)}switch(t){case 401:e="INVALID_API_KEY",o="Invalid API key. Please check your configuration.";break;case 429:e="RATE_LIMITED",o="Rate limit exceeded. Please wait before trying again.";break;case 408:case 504:e="TIMEOUT";break}return new a(o,e,this.config.provider,{status:t,body:r})}validateConfiguration(){if(!this.isConfigured())throw new a(`${this.name} provider is not configured. Please provide an API key.`,"NOT_CONFIGURED",this.config.provider)}getCommonHeaders(){return{"Content-Type":"application/json"}}};export{f as a,b,h as c,a as d,v as e,C as f,L as g,P as h,T as i,x as j,y as k};
